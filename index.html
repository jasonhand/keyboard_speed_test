<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datadog Typing Test & Keyboard Analyzer</title>
    <script>
        (function(h,o,u,n,d) {
          h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
          d=o.createElement(u);d.async=1;d.src=n
          n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
        })(window,document,'script','https://www.datadoghq-browser-agent.com/us1/v6/datadog-rum.js','DD_RUM')
        window.DD_RUM.onReady(function() {
          window.DD_RUM.init({
            clientToken: 'pubc7932cbc69c976016659135760251538',
            applicationId: 'b7e70078-1335-4a18-abc8-30a557d61174',
            // `site` refers to the Datadog site parameter of your organization
            // see https://docs.datadoghq.com/getting_started/site/
            site: 'datadoghq.com',
            service: 'keyboard-speed-tests',
            env: 'prod',
            // Specify a version number to identify the deployed version of your application in Datadog
            // version: '1.0.0',
            sessionSampleRate: 100,
            sessionReplaySampleRate: 100,
            defaultPrivacyLevel: 'mask-user-input',
          });
        })
      </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-image: url('https://imgix.datadoghq.com/img/products/bits-ai/bits_ai_hero_desktop.png?ch=Width,DPR,Save-Data&fm=png&auto=format&fit=max');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(17, 24, 39, 0.85); /* gray-900 with 85% opacity */
            z-index: -1;
        }
        .caret {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .correct { color: #632CA6; } /* Datadog purple */
        .incorrect { color: #f87171; text-decoration: underline; } /* red-400 */
        .untyped { color: #9ca3af; } /* gray-400 */
        
        /* Toast Animation */
        .toast-enter {
            transform: translateY(100%);
            opacity: 0;
        }
        .toast-enter-active {
            transform: translateY(0);
            opacity: 1;
            transition: all 0.3s ease-out;
        }
        .toast-exit {
            transform: translateY(0);
            opacity: 1;
        }
        .toast-exit-active {
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.3s ease-in;
        }
        
        /* Timer Warning Animation */
        .timer-warning {
            animation: flashPurple 1s ease-in-out;
        }
        
        .timer-warning::before {
            background: rgba(99, 44, 166, 0.8) !important; /* solid purple background */
        }
        
        @keyframes flashPurple {
            0%, 100% { 
                background-color: rgba(17, 24, 39, 0.85); /* normal background */
            }
            50% { 
                background-color: rgba(99, 44, 166, 0.8); /* solid purple flash */
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Datadog Logo Accent -->
    <div class="fixed top-8 right-8 z-5 pointer-events-none">
        <img src="https://imgix.datadoghq.com/img/about/presskit/logo-v/dd_vertical_white.png?auto=format&fit=max&w=847&dpr=2" 
             alt="Datadog Logo" 
             class="w-16 h-16 opacity-20 hover:opacity-30 transition-opacity duration-300">
    </div>
    
    <!-- Datadog Logo Accent Bottom Left -->
    <div class="fixed bottom-8 left-8 z-5 pointer-events-none">
        <img src="https://imgix.datadoghq.com/img/about/presskit/logo-v/dd_vertical_white.png?auto=format&fit=max&w=847&dpr=2" 
             alt="Datadog Logo" 
             class="w-12 h-12 opacity-10 hover:opacity-20 transition-opacity duration-300">
    </div>

    <div id="app" class="w-full max-w-4xl mx-auto relative z-10">

        <!-- Setup Screen -->
        <div id="setup-screen" class="text-center space-y-8">
            <h1 class="text-5xl font-bold text-white">Datadog Typing Test</h1>
            <p class="text-lg text-gray-400">Test your typing speed with Datadog documentation. Share your results and compete on the leaderboard!</p>
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg max-w-md mx-auto space-y-4">
                <div>
                    <label for="user-name" class="block text-sm font-medium text-gray-300 mb-2">Your Name</label>
                    <input type="text" id="user-name" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white focus:ring-2 focus:ring-purple-500 focus:outline-none" placeholder="Enter your name..." style="--tw-ring-color: #632CA6;">
                </div>
                <button id="start-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-md transition duration-300 ease-in-out transform hover:scale-105" style="background-color: #632CA6;">
                    Start Typing Test
                </button>
            </div>
            
            <!-- Leaderboard Section -->
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-white mb-4">Leaderboard</h2>
                <div id="leaderboard-container" class="space-y-2">
                    <div class="text-gray-400 text-sm">No results yet. Be the first to complete a test!</div>
                </div>
                <div class="mt-4 text-center">
                    <button id="copy-leaderboard-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md transition duration-300">
                        Copy Leaderboard URL
                    </button>
                </div>
            </div>
        </div>

        <!-- Typing Test Screen -->
        <div id="test-screen" class="hidden">
            <div class="grid grid-cols-4 gap-4 text-center mb-6">
                <div id="wpm-display" class="bg-gray-800 p-4 rounded-lg"><span class="text-4xl font-bold">0</span><span class="text-gray-400"> WPM</span></div>
                <div id="acc-display" class="bg-gray-800 p-4 rounded-lg"><span class="text-4xl font-bold">100</span><span class="text-gray-400">% Acc</span></div>
                <div id="errors-display" class="bg-gray-800 p-4 rounded-lg"><span class="text-4xl font-bold">0</span><span class="text-gray-400"> Errors</span></div>
                <div id="timer-display" class="bg-gray-800 p-4 rounded-lg"><span class="text-4xl font-bold text-white">30</span><span class="text-gray-400">s</span></div>
            </div>
            <div id="text-prompt-container" class="relative bg-gray-800 p-6 rounded-lg text-2xl leading-relaxed font-mono tracking-wider mb-4" style="min-height: 160px;">
                <p id="text-prompt"></p>
                <div id="caret" class="caret absolute" style="width: 2px; height: 2rem; top: 1.5rem; left: 1.5rem; background-color: #632CA6;"></div>
            </div>
            <input type="text" id="typing-input" class="opacity-0 absolute" autofocus>
            
            <!-- Prominent Countdown Timer -->
            <div id="countdown-overlay" class="fixed inset-0 flex items-center justify-center z-40 pointer-events-none">
                <div id="countdown-display" class="text-8xl font-bold text-white bg-black bg-opacity-50 rounded-full w-48 h-48 flex items-center justify-center hidden">
                    <span id="countdown-number">30</span>
                </div>
            </div>
            
            <div class="text-center">
                <button id="restart-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-md transition duration-300">Restart</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden text-center bg-gray-800 p-8 rounded-lg shadow-2xl">
            <h2 class="text-4xl font-bold mb-4">Test Complete!</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-white">
                <div class="bg-gray-700 p-4 rounded-lg">
                    <p class="text-gray-400 text-sm">WPM</p>
                    <p id="result-wpm" class="text-5xl font-bold">0</p>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg">
                    <p class="text-gray-400 text-sm">Accuracy</p>
                    <p id="result-acc" class="text-5xl font-bold">0%</p>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg">
                    <p class="text-gray-400 text-sm">Name</p>
                    <p id="result-keyboard" class="text-2xl font-semibold mt-3 truncate" title="User Name">N/A</p>
                </div>
            </div>
            <div class="mb-6">
                <p class="text-gray-400 text-sm mb-2">Share Your Result</p>
                <input type="text" id="share-url" class="w-full bg-gray-600 border border-gray-500 rounded-md px-3 py-2 text-gray-200 focus:outline-none" readonly>
            </div>
            <div id="datadog-source" class="mb-6 hidden">
                <p class="text-gray-400 text-sm mb-2">Text Source</p>
                <a id="datadog-link" href="#" target="_blank" class="text-indigo-400 hover:text-indigo-300 underline break-all">
                    View in Datadog Documentation
                </a>
            </div>
            <div class="mb-6">
                <p class="text-gray-400 text-sm mb-2">Ready to try Datadog?</p>
                <a href="https://app.datadoghq.com" target="_blank" class="inline-block text-white font-bold py-3 px-6 rounded-md transition duration-300 transform hover:scale-105" style="background-color: #632CA6;">
                    Try Datadog Free
                </a>
            </div>
            <div id="results-actions" class="flex justify-center space-x-4">
                <button id="new-test-btn" class="w-1/2 text-white font-bold py-3 px-4 rounded-md transition duration-300" style="background-color: #632CA6;">New Test</button>
                <button id="copy-url-btn" class="w-1/2 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-md transition duration-300">Copy URL</button>
            </div>
        </div>

    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 left-4 right-4 z-50 pointer-events-none">
        <div id="bits-toast" class="hidden bg-gray-800 border border-gray-600 rounded-lg p-4 shadow-2xl max-w-md mx-auto pointer-events-auto">
            <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                    <img src="https://imgix.datadoghq.com/img/about/presskit/logo-v/dd_vertical_white.png?auto=format&fit=max&w=847&dpr=2" 
                         alt="Datadog Logo" 
                         class="w-8 h-8 rounded-full object-cover">
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center space-x-2 mb-2">
                        <span class="text-white font-semibold">Bits AI</span>
                        <span class="text-gray-400 text-sm">just now</span>
                    </div>
                    <p class="text-gray-300 mb-3">Great job! Would you like to start over or share your result?</p>
                    <div class="flex space-x-2">
                        <button id="toast-new-test" class="text-white px-3 py-1 rounded text-sm transition duration-200" style="background-color: #632CA6;">
                            Start Over
                        </button>
                        <button id="toast-share" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm transition duration-200">
                            Share
                        </button>
                        <button id="toast-dismiss" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition duration-200">
                            Dismiss
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const app = document.getElementById('app');
            const setupScreen = document.getElementById('setup-screen');
            const testScreen = document.getElementById('test-screen');
            const resultsScreen = document.getElementById('results-screen');

            const userNameInput = document.getElementById('user-name');
            const startBtn = document.getElementById('start-btn');
            const copyLeaderboardBtn = document.getElementById('copy-leaderboard-btn');
            const leaderboardContainer = document.getElementById('leaderboard-container');
            
            // Toast elements
            const bitsToast = document.getElementById('bits-toast');
            const toastNewTest = document.getElementById('toast-new-test');
            const toastShare = document.getElementById('toast-share');
            const toastDismiss = document.getElementById('toast-dismiss');
            
            const wpmDisplay = document.getElementById('wpm-display').querySelector('span:first-child');
            const accDisplay = document.getElementById('acc-display').querySelector('span:first-child');
            const errorsDisplay = document.getElementById('errors-display').querySelector('span:first-child');
            const timerDisplay = document.getElementById('timer-display').querySelector('span:first-child');
            const countdownDisplay = document.getElementById('countdown-display');
            const countdownNumber = document.getElementById('countdown-number');
            
            const textPromptContainer = document.getElementById('text-prompt-container');
            const textPrompt = document.getElementById('text-prompt');
            const typingInput = document.getElementById('typing-input');
            const caret = document.getElementById('caret');
            const restartBtn = document.getElementById('restart-btn');

            const resultWpm = document.getElementById('result-wpm');
            const resultAcc = document.getElementById('result-acc');
            const resultKeyboard = document.getElementById('result-keyboard');
            const shareUrlInput = document.getElementById('share-url');
            const resultsActions = document.getElementById('results-actions');
            const newTestBtn = document.getElementById('new-test-btn');
            const copyUrlBtn = document.getElementById('copy-url-btn');
            const datadogSource = document.getElementById('datadog-source');
            const datadogLink = document.getElementById('datadog-link');

            // --- Datadog Documentation Snippets ---
            const datadogSnippets = [
                {
                    text: "Datadog is a monitoring and analytics platform for IT infrastructure, cloud services, and applications. It provides real-time visibility into your entire technology stack.",
                    source: "https://docs.datadoghq.com/getting_started/",
                    title: "Getting Started"
                },
                {
                    text: "The Datadog Agent is a lightweight daemon that runs on your hosts and collects events and metrics from hosts and sends them to Datadog, where you can analyze your monitoring and performance data.",
                    source: "https://docs.datadoghq.com/agent/",
                    title: "Datadog Agent"
                },
                {
                    text: "APM (Application Performance Monitoring) provides deep visibility into your application's performance by tracing requests as they flow through your services and infrastructure.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "APM & Distributed Tracing"
                },
                {
                    text: "Logs provide visibility into the behavior of your applications and infrastructure. They help you understand how your applications are performing and troubleshoot issues.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Log Management"
                },
                {
                    text: "Infrastructure monitoring gives you visibility into your hosts, containers, and cloud services. Monitor your infrastructure in real-time and get alerted when issues arise.",
                    source: "https://docs.datadoghq.com/infrastructure/",
                    title: "Infrastructure Monitoring"
                },
                {
                    text: "Real User Monitoring (RUM) enables you to visualize and analyze the real-time performance and user journeys of your application's individual users.",
                    source: "https://docs.datadoghq.com/real_user_monitoring/",
                    title: "Real User Monitoring"
                },
                {
                    text: "Synthetic monitoring allows you to create automated tests that simulate user requests and actions to ensure your applications are working correctly from the user's perspective.",
                    source: "https://docs.datadoghq.com/synthetics/",
                    title: "Synthetic Monitoring"
                },
                {
                    text: "Security monitoring helps you detect threats and vulnerabilities in your infrastructure and applications. Monitor for security events and get alerted when potential threats are detected.",
                    source: "https://docs.datadoghq.com/security_platform/",
                    title: "Security Platform"
                },
                {
                    text: "Dashboards provide a customizable view of your metrics, logs, and traces. Create visualizations to monitor your infrastructure and applications in real-time.",
                    source: "https://docs.datadoghq.com/dashboards/",
                    title: "Dashboards"
                },
                {
                    text: "Alerts notify you when your metrics exceed certain thresholds. Configure alerting rules to ensure you're notified of issues before they impact your users.",
                    source: "https://docs.datadoghq.com/monitors/",
                    title: "Monitors"
                },
                {
                    text: "The Datadog Agent can collect metrics from over 400 integrations, including databases, web servers, cloud services, and custom applications.",
                    source: "https://docs.datadoghq.com/agent/",
                    title: "Agent Integrations"
                },
                {
                    text: "Distributed tracing allows you to track requests as they flow through your microservices architecture, helping you identify bottlenecks and performance issues.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Distributed Tracing"
                },
                {
                    text: "Log aggregation in Datadog enables you to search, filter, and analyze logs from all your applications and infrastructure in one centralized location.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Log Aggregation"
                },
                {
                    text: "Container monitoring provides visibility into your Docker containers, Kubernetes clusters, and containerized applications with automatic service discovery.",
                    source: "https://docs.datadoghq.com/containers/",
                    title: "Container Monitoring"
                },
                {
                    text: "Cloud monitoring supports AWS, Azure, Google Cloud Platform, and other cloud providers with native integration and automatic resource discovery.",
                    source: "https://docs.datadoghq.com/integrations/",
                    title: "Cloud Monitoring"
                },
                {
                    text: "Custom metrics allow you to track business-specific KPIs and application metrics that are unique to your organization and use cases.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Custom Metrics"
                },
                {
                    text: "Service Level Objectives (SLOs) help you define and track the reliability of your services based on business-critical metrics and user experience.",
                    source: "https://docs.datadoghq.com/monitors/service_level_objectives/",
                    title: "Service Level Objectives"
                },
                {
                    text: "Network Performance Monitoring provides visibility into network traffic, latency, and connectivity issues across your infrastructure and cloud services.",
                    source: "https://docs.datadoghq.com/network_performance_monitoring/",
                    title: "Network Performance Monitoring"
                },
                {
                    text: "Database monitoring tracks performance metrics, query execution times, and connection pools for popular databases like PostgreSQL, MySQL, and MongoDB.",
                    source: "https://docs.datadoghq.com/integrations/",
                    title: "Database Monitoring"
                },
                {
                    text: "Error tracking automatically captures and aggregates application errors, providing stack traces and context to help you debug issues quickly.",
                    source: "https://docs.datadoghq.com/real_user_monitoring/error_tracking/",
                    title: "Error Tracking"
                },
                {
                    text: "Profiling helps you identify performance bottlenecks in your code by analyzing CPU usage, memory allocation, and function execution times.",
                    source: "https://docs.datadoghq.com/profiler/",
                    title: "Continuous Profiler"
                },
                {
                    text: "Incident management enables teams to collaborate effectively during outages with automated alerting, escalation policies, and post-incident analysis.",
                    source: "https://docs.datadoghq.com/monitors/incident_management/",
                    title: "Incident Management"
                },
                {
                    text: "Metric correlation automatically identifies relationships between different metrics, helping you understand the root cause of performance issues.",
                    source: "https://docs.datadoghq.com/monitors/",
                    title: "Metric Correlation"
                },
                {
                    text: "Log-based metrics allow you to create metrics from log data, enabling you to track business events and application behavior over time.",
                    source: "https://docs.datadoghq.com/logs/logs_to_metrics/",
                    title: "Log-based Metrics"
                },
                {
                    text: "Trace sampling helps you control costs while maintaining visibility by sampling a percentage of distributed traces based on your configuration.",
                    source: "https://docs.datadoghq.com/tracing/trace_sampling_and_storage/",
                    title: "Trace Sampling"
                },
                {
                    text: "Custom dashboards can be shared with stakeholders and embedded in other applications to provide real-time visibility into your systems.",
                    source: "https://docs.datadoghq.com/dashboards/",
                    title: "Dashboard Sharing"
                },
                {
                    text: "Multi-region deployment monitoring allows you to track the performance and availability of your applications across different geographic regions.",
                    source: "https://docs.datadoghq.com/agent/",
                    title: "Multi-region Monitoring"
                },
                {
                    text: "Service dependencies automatically map the relationships between your services, helping you understand the impact of failures and changes.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Service Dependencies"
                },
                {
                    text: "Anomaly detection uses machine learning to identify unusual patterns in your metrics, helping you detect issues before they impact users.",
                    source: "https://docs.datadoghq.com/monitors/create/types/anomaly/",
                    title: "Anomaly Detection"
                },
                {
                    text: "Forecast monitors predict future metric values based on historical data, helping you plan capacity and identify potential issues.",
                    source: "https://docs.datadoghq.com/monitors/create/types/forecasts/",
                    title: "Forecast Monitoring"
                },
                {
                    text: "Composite monitors combine multiple conditions to create complex alerting scenarios that better reflect your application's health.",
                    source: "https://docs.datadoghq.com/monitors/create/types/composite/",
                    title: "Composite Monitors"
                },
                {
                    text: "Metric metadata allows you to add custom tags and descriptions to your metrics, making them easier to organize and understand.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Metric Metadata"
                },
                {
                    text: "Log parsing uses regular expressions to extract structured data from log messages, enabling better search and analysis capabilities.",
                    source: "https://docs.datadoghq.com/logs/log_configuration/parsing/",
                    title: "Log Parsing"
                },
                {
                    text: "Trace analytics enables you to search and filter distributed traces based on tags, helping you identify patterns and troubleshoot issues.",
                    source: "https://docs.datadoghq.com/tracing/trace_explorer/",
                    title: "Trace Analytics"
                },
                {
                    text: "Host maps provide a visual representation of your infrastructure, showing the relationships and health status of your hosts and services.",
                    source: "https://docs.datadoghq.com/infrastructure/hostmap/",
                    title: "Host Maps"
                },
                {
                    text: "Process monitoring tracks individual processes running on your hosts, providing visibility into resource usage and performance metrics.",
                    source: "https://docs.datadoghq.com/infrastructure/process/",
                    title: "Process Monitoring"
                },
                {
                    text: "Custom widgets allow you to create specialized visualizations for your dashboards, including custom HTML, iframes, and third-party integrations.",
                    source: "https://docs.datadoghq.com/dashboards/widgets/",
                    title: "Custom Widgets"
                },
                {
                    text: "Metric alerts can be configured with different thresholds for different time periods, enabling more sophisticated monitoring strategies.",
                    source: "https://docs.datadoghq.com/monitors/create/types/metric/",
                    title: "Metric Alerts"
                },
                {
                    text: "Log retention policies allow you to control how long logs are stored, helping you manage costs while maintaining compliance requirements.",
                    source: "https://docs.datadoghq.com/logs/archives/",
                    title: "Log Retention"
                },
                {
                    text: "Service level indicators (SLIs) measure the reliability and performance of your services from the user's perspective.",
                    source: "https://docs.datadoghq.com/monitors/service_level_objectives/",
                    title: "Service Level Indicators"
                },
                {
                    text: "Trace injection allows you to add custom context to your distributed traces, helping you correlate business events with technical performance.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Trace Injection"
                },
                {
                    text: "Metric aggregation functions enable you to combine multiple metrics into meaningful business KPIs and performance indicators.",
                    source: "https://docs.datadoghq.com/dashboards/querying/",
                    title: "Metric Aggregation"
                },
                {
                    text: "Log-based alerts can trigger notifications based on log content, enabling you to respond quickly to application errors and security events.",
                    source: "https://docs.datadoghq.com/monitors/create/types/log/",
                    title: "Log-based Alerts"
                },
                {
                    text: "APM traces automatically capture database queries, external API calls, and cache operations to provide comprehensive performance visibility.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "APM Traces"
                },
                {
                    text: "Infrastructure as Code monitoring allows you to track changes to your infrastructure and correlate them with performance impacts.",
                    source: "https://docs.datadoghq.com/infrastructure/",
                    title: "Infrastructure as Code"
                },
                {
                    text: "Custom log pipelines enable you to transform, enrich, and route log data based on your specific requirements and use cases.",
                    source: "https://docs.datadoghq.com/logs/log_configuration/pipelines/",
                    title: "Custom Log Pipelines"
                },
                {
                    text: "Metric correlation analysis automatically identifies relationships between different metrics, helping you understand system dependencies.",
                    source: "https://docs.datadoghq.com/monitors/",
                    title: "Metric Correlation Analysis"
                },
                {
                    text: "Service mesh monitoring provides visibility into communication between microservices, helping you optimize performance and reliability.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Service Mesh Monitoring"
                },
                {
                    text: "Log-based metrics can be used to create business KPIs, such as user sign-ups, order completions, and feature usage patterns.",
                    source: "https://docs.datadoghq.com/logs/logs_to_metrics/",
                    title: "Business KPIs"
                },
                {
                    text: "Distributed tracing automatically instruments popular frameworks and libraries, providing out-of-the-box visibility into application performance.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Auto-instrumentation"
                },
                {
                    text: "Metric forecasting uses machine learning to predict future values, helping you plan capacity and identify potential issues before they occur.",
                    source: "https://docs.datadoghq.com/monitors/create/types/forecasts/",
                    title: "Metric Forecasting"
                },
                {
                    text: "Log correlation automatically links logs with traces and metrics, providing context for troubleshooting and performance analysis.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Log Correlation"
                },
                {
                    text: "Custom metric submission allows you to send business metrics and application-specific data directly to Datadog from your code.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Custom Metric Submission"
                },
                {
                    text: "Service level agreements (SLAs) can be tracked using SLOs, ensuring your applications meet the performance expectations of your users.",
                    source: "https://docs.datadoghq.com/monitors/service_level_objectives/",
                    title: "Service Level Agreements"
                },
                {
                    text: "Trace sampling strategies can be configured to capture different percentages of traces based on service, error rates, or custom criteria.",
                    source: "https://docs.datadoghq.com/tracing/trace_sampling_and_storage/",
                    title: "Trace Sampling Strategies"
                },
                {
                    text: "Log enrichment automatically adds context to your logs, including host information, service tags, and custom metadata.",
                    source: "https://docs.datadoghq.com/logs/log_configuration/attributes_naming_convention/",
                    title: "Log Enrichment"
                },
                {
                    text: "Metric rollup functions enable you to aggregate data over different time periods, helping you analyze trends and patterns in your metrics.",
                    source: "https://docs.datadoghq.com/dashboards/querying/",
                    title: "Metric Rollup"
                },
                {
                    text: "APM flame graphs provide a visual representation of CPU usage, helping you identify performance bottlenecks in your application code.",
                    source: "https://docs.datadoghq.com/profiler/",
                    title: "Flame Graphs"
                },
                {
                    text: "Custom alert conditions allow you to create complex monitoring rules that better reflect the health and performance of your applications.",
                    source: "https://docs.datadoghq.com/monitors/create/",
                    title: "Custom Alert Conditions"
                },
                {
                    text: "Log-based service discovery automatically identifies services from your log data, enabling better organization and monitoring.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Log-based Service Discovery"
                },
                {
                    text: "Metric metadata management allows you to add descriptions, units, and tags to your metrics, making them more discoverable and understandable.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Metric Metadata Management"
                },
                {
                    text: "Trace-based service maps automatically generate visual representations of your service architecture based on distributed tracing data.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Service Maps"
                },
                {
                    text: "Log retention and archival policies help you manage storage costs while maintaining compliance with data retention requirements.",
                    source: "https://docs.datadoghq.com/logs/archives/",
                    title: "Log Retention Policies"
                },
                {
                    text: "Custom metric aggregation enables you to create business-specific KPIs by combining multiple metrics and applying custom calculations.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Custom Metric Aggregation"
                },
                {
                    text: "APM dependency tracking automatically maps the relationships between your services, helping you understand the impact of changes and failures.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Dependency Tracking"
                },
                {
                    text: "Metric anomaly detection uses statistical analysis to identify unusual patterns in your data, helping you detect issues before they impact users.",
                    source: "https://docs.datadoghq.com/monitors/create/types/anomaly/",
                    title: "Anomaly Detection"
                },
                {
                    text: "Log-based alerting can trigger notifications based on log volume, error rates, or specific log content patterns.",
                    source: "https://docs.datadoghq.com/monitors/create/types/log/",
                    title: "Log-based Alerting"
                },
                {
                    text: "Custom dashboard templates allow you to create reusable dashboard configurations that can be applied across different environments and services.",
                    source: "https://docs.datadoghq.com/dashboards/",
                    title: "Dashboard Templates"
                },
                {
                    text: "Trace-based performance analysis provides detailed insights into request latency, database queries, and external service calls.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Performance Analysis"
                },
                {
                    text: "Metric correlation analysis automatically identifies relationships between different metrics, helping you understand system dependencies and root causes.",
                    source: "https://docs.datadoghq.com/monitors/",
                    title: "Correlation Analysis"
                },
                {
                    text: "Log parsing and enrichment automatically extracts structured data from log messages, enabling better search, filtering, and analysis capabilities.",
                    source: "https://docs.datadoghq.com/logs/log_configuration/parsing/",
                    title: "Log Parsing and Enrichment"
                },
                {
                    text: "Custom metric submission APIs allow you to send business metrics and application-specific data directly to Datadog from your applications.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Metric Submission APIs"
                },
                {
                    text: "Service level objective tracking enables you to measure and improve the reliability and performance of your services based on business-critical metrics.",
                    source: "https://docs.datadoghq.com/monitors/service_level_objectives/",
                    title: "SLO Tracking"
                },
                {
                    text: "Distributed tracing automatically instruments popular web frameworks, databases, and messaging systems to provide comprehensive visibility.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Auto-instrumentation"
                },
                {
                    text: "Metric forecasting and trend analysis help you predict future resource needs and identify potential performance issues before they impact users.",
                    source: "https://docs.datadoghq.com/monitors/create/types/forecasts/",
                    title: "Forecasting and Trends"
                },
                {
                    text: "Log correlation and analysis automatically links logs with traces and metrics, providing comprehensive context for troubleshooting and performance analysis.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Log Correlation and Analysis"
                },
                {
                    text: "Custom dashboard widgets enable you to create specialized visualizations and integrate third-party tools and data sources into your monitoring dashboards.",
                    source: "https://docs.datadoghq.com/dashboards/widgets/",
                    title: "Custom Widgets"
                },
                {
                    text: "APM flame graphs and profiling provide detailed insights into CPU usage, memory allocation, and function execution times to help optimize application performance.",
                    source: "https://docs.datadoghq.com/profiler/",
                    title: "Flame Graphs and Profiling"
                },
                {
                    text: "Metric rollup and aggregation functions enable you to analyze trends and patterns in your data across different time periods and dimensions.",
                    source: "https://docs.datadoghq.com/dashboards/querying/",
                    title: "Metric Rollup and Aggregation"
                },
                {
                    text: "Service mesh monitoring provides visibility into communication patterns between microservices, helping you optimize performance and identify bottlenecks.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Service Mesh Monitoring"
                },
                {
                    text: "Log-based service discovery and monitoring automatically identifies services from your log data and provides comprehensive visibility into their performance.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Service Discovery"
                },
                {
                    text: "Custom metric metadata management allows you to add descriptions, units, tags, and other metadata to your metrics for better organization and understanding.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Metric Metadata Management"
                },
                {
                    text: "Trace-based service dependency mapping automatically generates visual representations of your service architecture and dependencies based on distributed tracing data.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Service Dependencies"
                },
                {
                    text: "Log retention and archival policies help you manage storage costs while maintaining compliance with data retention requirements and audit trails.",
                    source: "https://docs.datadoghq.com/logs/archives/",
                    title: "Log Retention and Archival"
                },
                {
                    text: "Custom metric aggregation and calculation functions enable you to create business-specific KPIs and performance indicators by combining multiple metrics.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Custom Metric Aggregation"
                },
                {
                    text: "APM dependency tracking and analysis automatically maps the relationships between your services and helps you understand the impact of changes and failures.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Dependency Analysis"
                },
                {
                    text: "Metric anomaly detection and alerting uses statistical analysis and machine learning to identify unusual patterns and trigger proactive notifications.",
                    source: "https://docs.datadoghq.com/monitors/create/types/anomaly/",
                    title: "Anomaly Detection and Alerting"
                },
                {
                    text: "Log-based alerting and monitoring can trigger notifications based on log volume, error rates, specific content patterns, and business events.",
                    source: "https://docs.datadoghq.com/monitors/create/types/log/",
                    title: "Log-based Monitoring"
                },
                {
                    text: "Custom dashboard templates and sharing capabilities allow you to create reusable dashboard configurations and share them across teams and environments.",
                    source: "https://docs.datadoghq.com/dashboards/",
                    title: "Dashboard Templates and Sharing"
                },
                {
                    text: "Trace-based performance analysis and optimization provides detailed insights into request latency, database queries, and external service calls to help improve application performance.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Performance Analysis and Optimization"
                },
                {
                    text: "Metric correlation analysis and visualization automatically identifies relationships between different metrics and helps you understand system dependencies and root causes.",
                    source: "https://docs.datadoghq.com/monitors/",
                    title: "Correlation Analysis and Visualization"
                },
                {
                    text: "Log parsing, enrichment, and analysis automatically extracts structured data from log messages and enables comprehensive search, filtering, and analysis capabilities.",
                    source: "https://docs.datadoghq.com/logs/log_configuration/parsing/",
                    title: "Log Parsing and Analysis"
                },
                {
                    text: "Custom metric submission APIs and SDKs allow you to send business metrics and application-specific data directly to Datadog from your applications and services.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Metric Submission APIs and SDKs"
                },
                {
                    text: "Service level objective tracking and reporting enables you to measure, monitor, and improve the reliability and performance of your services based on business-critical metrics.",
                    source: "https://docs.datadoghq.com/monitors/service_level_objectives/",
                    title: "SLO Tracking and Reporting"
                },
                {
                    text: "Distributed tracing and auto-instrumentation automatically instruments popular web frameworks, databases, and messaging systems to provide comprehensive application visibility.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Distributed Tracing and Auto-instrumentation"
                },
                {
                    text: "Metric forecasting, trend analysis, and capacity planning help you predict future resource needs and identify potential performance issues before they impact users.",
                    source: "https://docs.datadoghq.com/monitors/create/types/forecasts/",
                    title: "Forecasting and Capacity Planning"
                },
                {
                    text: "Log correlation, analysis, and troubleshooting automatically links logs with traces and metrics to provide comprehensive context for debugging and performance optimization.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Log Correlation and Troubleshooting"
                },
                {
                    text: "Custom dashboard widgets and integrations enable you to create specialized visualizations and integrate third-party tools and data sources into your monitoring environment.",
                    source: "https://docs.datadoghq.com/dashboards/widgets/",
                    title: "Custom Widgets and Integrations"
                },
                {
                    text: "APM flame graphs, profiling, and performance optimization provide detailed insights into CPU usage, memory allocation, and function execution times.",
                    source: "https://docs.datadoghq.com/profiler/",
                    title: "APM Profiling and Optimization"
                },
                {
                    text: "Metric rollup, aggregation, and analysis functions enable you to analyze trends, patterns, and anomalies in your data across different time periods and dimensions.",
                    source: "https://docs.datadoghq.com/dashboards/querying/",
                    title: "Metric Analysis and Aggregation"
                },
                {
                    text: "Service mesh monitoring and optimization provides visibility into communication patterns between microservices and helps you identify and resolve performance bottlenecks.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Service Mesh Optimization"
                },
                {
                    text: "Log-based service discovery, monitoring, and alerting automatically identifies services from your log data and provides comprehensive visibility and notification capabilities.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Service Discovery and Monitoring"
                },
                {
                    text: "Custom metric metadata management and organization allows you to add descriptions, units, tags, and other metadata to your metrics for better discoverability and understanding.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Metric Organization and Management"
                },
                {
                    text: "Trace-based service dependency mapping and visualization automatically generates comprehensive representations of your service architecture and dependencies.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Service Dependency Visualization"
                },
                {
                    text: "Log retention, archival, and compliance policies help you manage storage costs while maintaining compliance with data retention requirements and audit trail standards.",
                    source: "https://docs.datadoghq.com/logs/archives/",
                    title: "Log Retention and Compliance"
                },
                {
                    text: "Custom metric aggregation, calculation, and business intelligence functions enable you to create sophisticated KPIs and performance indicators for your organization.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Business Intelligence and KPIs"
                },
                {
                    text: "APM dependency tracking, analysis, and impact assessment automatically maps service relationships and helps you understand the cascading effects of changes and failures.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Dependency Impact Assessment"
                },
                {
                    text: "Metric anomaly detection, alerting, and machine learning uses advanced statistical analysis to identify unusual patterns and trigger proactive notifications for potential issues.",
                    source: "https://docs.datadoghq.com/monitors/create/types/anomaly/",
                    title: "Machine Learning Anomaly Detection"
                },
                {
                    text: "Log-based alerting, monitoring, and business event tracking can trigger notifications based on log volume, error rates, content patterns, and business-critical events.",
                    source: "https://docs.datadoghq.com/monitors/create/types/log/",
                    title: "Business Event Monitoring"
                },
                {
                    text: "Custom dashboard templates, sharing, and collaboration capabilities allow you to create reusable dashboard configurations and share them across teams, environments, and stakeholders.",
                    source: "https://docs.datadoghq.com/dashboards/",
                    title: "Dashboard Collaboration"
                },
                {
                    text: "Trace-based performance analysis, optimization, and capacity planning provides detailed insights into request latency, database queries, and external service calls for strategic planning.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Performance Planning and Optimization"
                },
                {
                    text: "Metric correlation analysis, visualization, and root cause investigation automatically identifies relationships between different metrics and helps you understand system dependencies.",
                    source: "https://docs.datadoghq.com/monitors/",
                    title: "Root Cause Investigation"
                },
                {
                    text: "Log parsing, enrichment, analysis, and business intelligence automatically extracts structured data from log messages and enables comprehensive business insights and operational intelligence.",
                    source: "https://docs.datadoghq.com/logs/log_configuration/parsing/",
                    title: "Operational Intelligence"
                },
                {
                    text: "Custom metric submission APIs, SDKs, and integration frameworks allow you to send business metrics and application-specific data directly to Datadog from any application or service.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Comprehensive Metric Integration"
                },
                {
                    text: "Service level objective tracking, reporting, and business impact analysis enables you to measure, monitor, and improve service reliability based on business-critical metrics and user experience.",
                    source: "https://docs.datadoghq.com/monitors/service_level_objectives/",
                    title: "Business Impact Analysis"
                },
                {
                    text: "Distributed tracing, auto-instrumentation, and comprehensive application visibility automatically instruments popular frameworks and provides end-to-end request tracking across your entire technology stack.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "End-to-End Application Visibility"
                },
                {
                    text: "Metric forecasting, trend analysis, capacity planning, and predictive analytics help you predict future resource needs and identify potential performance issues before they impact users and business operations.",
                    source: "https://docs.datadoghq.com/monitors/create/types/forecasts/",
                    title: "Predictive Analytics and Planning"
                },
                {
                    text: "Log correlation, analysis, troubleshooting, and operational intelligence automatically links logs with traces and metrics to provide comprehensive context for debugging, performance optimization, and business insights.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Comprehensive Operational Intelligence"
                },
                {
                    text: "Custom dashboard widgets, integrations, and visualization capabilities enable you to create specialized visualizations and integrate third-party tools and data sources into your unified monitoring environment.",
                    source: "https://docs.datadoghq.com/dashboards/widgets/",
                    title: "Unified Monitoring Environment"
                },
                {
                    text: "APM flame graphs, profiling, performance optimization, and code-level insights provide detailed visibility into CPU usage, memory allocation, and function execution times for comprehensive application optimization.",
                    source: "https://docs.datadoghq.com/profiler/",
                    title: "Code-Level Performance Insights"
                },
                {
                    text: "Metric rollup, aggregation, analysis, and business intelligence functions enable you to analyze trends, patterns, anomalies, and business KPIs across different time periods and organizational dimensions.",
                    source: "https://docs.datadoghq.com/dashboards/querying/",
                    title: "Business Intelligence and Analytics"
                },
                {
                    text: "Service mesh monitoring, optimization, and traffic analysis provides comprehensive visibility into communication patterns between microservices and helps you identify, resolve, and prevent performance bottlenecks.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Service Mesh Traffic Analysis"
                },
                {
                    text: "Log-based service discovery, monitoring, alerting, and operational visibility automatically identifies services from your log data and provides comprehensive monitoring and notification capabilities for your entire infrastructure.",
                    source: "https://docs.datadoghq.com/logs/",
                    title: "Comprehensive Service Visibility"
                },
                {
                    text: "Custom metric metadata management, organization, and governance allows you to add descriptions, units, tags, and other metadata to your metrics for better discoverability, understanding, and compliance across your organization.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Metric Governance and Organization"
                },
                {
                    text: "Trace-based service dependency mapping, visualization, and impact analysis automatically generates comprehensive representations of your service architecture and helps you understand the cascading effects of changes and failures across your entire system.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "System-Wide Impact Analysis"
                },
                {
                    text: "Log retention, archival, compliance, and governance policies help you manage storage costs while maintaining compliance with data retention requirements, audit trail standards, and regulatory obligations across your organization.",
                    source: "https://docs.datadoghq.com/logs/archives/",
                    title: "Comprehensive Log Governance"
                },
                {
                    text: "Custom metric aggregation, calculation, business intelligence, and strategic analytics functions enable you to create sophisticated KPIs, performance indicators, and business insights that drive strategic decision-making across your organization.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Strategic Business Analytics"
                },
                {
                    text: "APM dependency tracking, analysis, impact assessment, and strategic planning automatically maps service relationships and helps you understand the cascading effects of changes and failures for comprehensive system planning and optimization.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Strategic System Planning"
                },
                {
                    text: "Metric anomaly detection, alerting, machine learning, and predictive analytics uses advanced statistical analysis and artificial intelligence to identify unusual patterns and trigger proactive notifications for potential issues before they impact business operations.",
                    source: "https://docs.datadoghq.com/monitors/create/types/anomaly/",
                    title: "AI-Powered Predictive Monitoring"
                },
                {
                    text: "Log-based alerting, monitoring, business event tracking, and operational intelligence can trigger notifications based on log volume, error rates, content patterns, and business-critical events to provide comprehensive operational visibility and business insights.",
                    source: "https://docs.datadoghq.com/monitors/create/types/log/",
                    title: "Comprehensive Business Intelligence"
                },
                {
                    text: "Custom dashboard templates, sharing, collaboration, and governance capabilities allow you to create reusable dashboard configurations and share them across teams, environments, and stakeholders while maintaining consistency and compliance across your organization.",
                    source: "https://docs.datadoghq.com/dashboards/",
                    title: "Enterprise Dashboard Governance"
                },
                {
                    text: "Trace-based performance analysis, optimization, capacity planning, and strategic resource management provides detailed insights into request latency, database queries, and external service calls for comprehensive strategic planning and resource optimization across your entire technology stack.",
                    source: "https://docs.datadoghq.com/tracing/",
                    title: "Strategic Resource Management"
                },
                {
                    text: "Metric correlation analysis, visualization, root cause investigation, and strategic insights automatically identifies relationships between different metrics and helps you understand system dependencies, business impacts, and strategic opportunities for optimization and growth.",
                    source: "https://docs.datadoghq.com/monitors/",
                    title: "Strategic System Insights"
                },
                {
                    text: "Log parsing, enrichment, analysis, business intelligence, and strategic operational insights automatically extracts structured data from log messages and enables comprehensive business insights, operational intelligence, and strategic decision-making capabilities across your entire organization.",
                    source: "https://docs.datadoghq.com/logs/log_configuration/parsing/",
                    title: "Strategic Operational Intelligence"
                },
                {
                    text: "Custom metric submission APIs, SDKs, integration frameworks, and enterprise connectivity allow you to send business metrics and application-specific data directly to Datadog from any application, service, or system while maintaining security, compliance, and governance standards across your entire organization.",
                    source: "https://docs.datadoghq.com/developers/metrics/",
                    title: "Enterprise Metric Integration"
                },
                {
                    text: "Service level objective tracking, reporting, business impact analysis, and strategic service management enables you to measure, monitor, and improve service reliability based on business-critical metrics, user experience, and strategic business objectives while driving continuous improvement and operational excellence across your entire organization.",
                    source: "https://docs.datadoghq.com/monitors/service_level_objectives/",
                    title: "Strategic Service Excellence"
                }
            ];

            // --- App State ---
            let state = {
                testDuration: 30,
                timer: null,
                timeLeft: 30,
                testActive: false,
                promptText: '',
                typedChars: 0,
                correctChars: 0,
                errorCount: 0,
                userName: 'Unknown',
                useDatadog: true,
                datadogSource: null,
                warningTimer: null
            };

            // --- Functions ---
            const init = () => {
                const urlParams = new URLSearchParams(window.location.search);
                
                // Check if URL contains leaderboard data
                if (urlParams.has('lb0_wpm')) {
                    loadLeaderboardFromURL(urlParams);
                    showSetupScreen();
                } else if (urlParams.has('wpm')) {
                    displayResultsFromURL(urlParams);
                } else {
                    showSetupScreen();
                }
                
                // Always update leaderboard display
                updateLeaderboardDisplay();
                addEventListeners();
            };

            const addEventListeners = () => {
                startBtn.addEventListener('click', startTest);
                restartBtn.addEventListener('click', () => {
                    if (window.DD_RUM && typeof window.DD_RUM.addAction === 'function') {
                        window.DD_RUM.addAction('restart_test', {
                            context: {
                                timeLeft: state.timeLeft,
                                typedChars: state.typedChars
                            }
                        });
                    }
                    resetTest();
                });
                newTestBtn.addEventListener('click', () => {
                    window.history.pushState({}, '', window.location.pathname);
                    showSetupScreen();
                });
                copyUrlBtn.addEventListener('click', copyShareUrl);
                copyLeaderboardBtn.addEventListener('click', copyLeaderboardUrl);
                typingInput.addEventListener('input', handleTyping);
                textPromptContainer.addEventListener('click', () => typingInput.focus());
                
                // Toast event listeners
                toastNewTest.addEventListener('click', () => {
                    hideToast();
                    window.history.pushState({}, '', window.location.pathname);
                    showSetupScreen();
                });
                toastShare.addEventListener('click', () => {
                    hideToast();
                    copyShareUrl();
                });
                toastDismiss.addEventListener('click', hideToast);
            };

            const showSetupScreen = () => {
                setupScreen.classList.remove('hidden');
                testScreen.classList.add('hidden');
                resultsScreen.classList.add('hidden');
                hideToast(); // Hide any existing toast
            };

            const showTestScreen = () => {
                setupScreen.classList.add('hidden');
                testScreen.classList.remove('hidden');
                resultsScreen.classList.add('hidden');
                typingInput.focus();
            };

            const showResultsScreen = () => {
                setupScreen.classList.add('hidden');
                testScreen.classList.add('hidden');
                resultsScreen.classList.remove('hidden');
                
                // Ensure results actions are visible (in case toast was dismissed)
                resultsActions.classList.remove('hidden');
            };

            const startTest = () => {
                state.userName = userNameInput.value.trim() || 'Unknown';
                state.timeLeft = state.testDuration;
                state.useDatadog = true;
                timerDisplay.textContent = state.timeLeft;
                
                if (window.DD_RUM && typeof window.DD_RUM.addAction === 'function') {
                    window.DD_RUM.addAction('start_test', {
                        context: {
                            userName: state.userName,
                            testDuration: state.testDuration,
                            useDatadog: state.useDatadog
                        }
                    });
                }

                resetTestState();
                setNewPrompt();
                showTestScreen();
            };
            
            const resetTest = () => {
                clearInterval(state.timer);
                state.timer = null;
                state.timeLeft = state.testDuration;
                timerDisplay.textContent = state.timeLeft;
                stopWarningEffect();
                resetTestState();
                setNewPrompt();
                typingInput.focus();
            };

            const resetTestState = () => {
                state.testActive = false;
                state.typedChars = 0;
                state.correctChars = 0;
                state.errorCount = 0;
                typingInput.value = '';
                wpmDisplay.textContent = '0';
                accDisplay.textContent = '100';
                errorsDisplay.textContent = '0';
                stopWarningEffect();
                countdownDisplay.classList.add('hidden');
            };

            const setNewPrompt = () => {
                const randomSnippet = datadogSnippets[Math.floor(Math.random() * datadogSnippets.length)];
                state.promptText = randomSnippet.text;
                state.datadogSource = randomSnippet;
                textPrompt.innerHTML = state.promptText.split('').map(char => `<span class="untyped">${char}</span>`).join('');
                updateCaretPosition();
            };

            const handleTyping = () => {
                if (!state.testActive && typingInput.value.length > 0) {
                    startTimer();
                }

                const typedText = typingInput.value;
                const promptSpans = textPrompt.querySelectorAll('span');
                state.typedChars = typedText.length;
                state.correctChars = 0;
                state.errorCount = 0;

                promptSpans.forEach((charSpan, index) => {
                    const char = typedText[index];
                    if (char == null) {
                        charSpan.className = 'untyped';
                    } else if (char === charSpan.innerText) {
                        charSpan.className = 'correct';
                        state.correctChars++;
                    } else {
                        charSpan.className = 'incorrect';
                        state.errorCount++;
                    }
                });
                
                updateStats();
                updateCaretPosition();

                if (state.typedChars === state.promptText.length) {
                    endTest();
                }
            };

            const startTimer = () => {
                state.testActive = true;
                const startTime = Date.now();

                state.timer = setInterval(() => {
                    const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                    state.timeLeft = state.testDuration - elapsedTime;
                    timerDisplay.textContent = state.timeLeft;
                    countdownNumber.textContent = state.timeLeft;
                    
                    // Show countdown when 10 seconds or less remain
                    if (state.timeLeft <= 10 && state.timeLeft > 0) {
                        countdownDisplay.classList.remove('hidden');
                        startWarningEffect();
                    } else {
                        countdownDisplay.classList.add('hidden');
                    }
                    
                    if(state.testActive) {
                       updateStats();
                    }

                    if (state.timeLeft <= 0) {
                        endTest();
                    }
                }, 1000);
            };

            const updateStats = () => {
                const elapsedTime = state.testDuration - state.timeLeft;
                const wpm = elapsedTime > 0 ? Math.round((state.correctChars / 5) / (elapsedTime / 60)) : 0;
                const accuracy = state.typedChars > 0 ? Math.round((state.correctChars / state.typedChars) * 100) : 100;

                wpmDisplay.textContent = wpm;
                accDisplay.textContent = accuracy;
                errorsDisplay.textContent = state.errorCount;
            };

            const startWarningEffect = () => {
                // Only start if not already running
                if (state.warningTimer) return;
                
                const body = document.body;
                state.warningTimer = setInterval(() => {
                    body.classList.add('timer-warning');
                    setTimeout(() => {
                        body.classList.remove('timer-warning');
                    }, 500);
                }, 1000);
            };

            const stopWarningEffect = () => {
                if (state.warningTimer) {
                    clearInterval(state.warningTimer);
                    state.warningTimer = null;
                    document.body.classList.remove('timer-warning');
                }
                countdownDisplay.classList.add('hidden');
            };

            const updateCaretPosition = () => {
                const promptSpans = textPrompt.querySelectorAll('span');
                const lastTypedChar = promptSpans[state.typedChars - 1];
                const nextChar = promptSpans[state.typedChars];

                if (state.typedChars === 0) {
                    caret.style.top = `${nextChar.offsetTop}px`;
                    caret.style.left = `${nextChar.offsetLeft}px`;
                } else if (nextChar) {
                    caret.style.top = `${nextChar.offsetTop}px`;
                    caret.style.left = `${nextChar.offsetLeft}px`;
                } else { 
                    caret.style.top = `${lastTypedChar.offsetTop}px`;
                    caret.style.left = `${lastTypedChar.offsetLeft + lastTypedChar.offsetWidth}px`;
                }
                caret.style.height = `${nextChar ? nextChar.offsetHeight : lastTypedChar.offsetHeight}px`;
            };

            const endTest = () => {
                clearInterval(state.timer);
                state.testActive = false;
                typingInput.blur();
                stopWarningEffect();

                const elapsedTime = state.testDuration - state.timeLeft;
                const finalWpm = elapsedTime > 0 ? Math.round((state.correctChars / 5) / (elapsedTime / 60)) : 0;
                const finalAccuracy = state.typedChars > 0 ? Math.round((state.correctChars / state.typedChars) * 100) : 100;
                
                if (window.DD_RUM && typeof window.DD_RUM.addAction === 'function') {
                    window.DD_RUM.addAction('test_completed', {
                        context: {
                            wpm: finalWpm,
                            accuracy: finalAccuracy,
                            errors: state.errorCount,
                            userName: state.userName,
                            useDatadog: state.useDatadog
                        }
                    });
                }

                resultWpm.textContent = finalWpm;
                resultAcc.textContent = `${finalAccuracy}%`;
                resultKeyboard.textContent = state.userName;
                resultKeyboard.title = state.userName;

                // Always show Datadog source link since all tests use Datadog content
                if (state.datadogSource) {
                    datadogLink.href = state.datadogSource.source;
                    datadogLink.textContent = `${state.datadogSource.title} - Datadog Documentation`;
                    datadogSource.classList.remove('hidden');
                }

                generateShareUrl(finalWpm, finalAccuracy);
                showResultsScreen();
                
                // Show Bits AI toast after a short delay
                setTimeout(() => {
                    showToast();
                }, 1000);
            };

            const generateShareUrl = (wpm, accuracy) => {
                const params = new URLSearchParams({
                    wpm: wpm,
                    acc: accuracy,
                    name: state.userName,
                    ts: new Date().toISOString(),
                    text: btoa(state.promptText)
                });
                
                // Always add Datadog source info since all tests use Datadog content
                if (state.datadogSource) {
                    params.append('dd', '1');
                    params.append('dd_title', state.datadogSource.title);
                    params.append('dd_source', state.datadogSource.source);
                }
                
                const url = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
                shareUrlInput.value = url;
                window.history.pushState({ wpm, accuracy }, '', url);
                
                // Add to leaderboard
                addToLeaderboard(wpm, accuracy, state.userName);
            };

            const copyShareUrl = () => {
                if (window.DD_RUM && typeof window.DD_RUM.addAction === 'function') {
                    window.DD_RUM.addAction('copy_share_url');
                }
                shareUrlInput.select();
                try {
                    document.execCommand('copy');
                    copyUrlBtn.textContent = 'Copied!';
                    setTimeout(() => { copyUrlBtn.textContent = 'Copy URL'; }, 2000);
                } catch (err) {
                    console.error('Failed to copy URL: ', err);
                    alert('Failed to copy. Please copy the URL manually.');
                }
            };
            
            const displayResultsFromURL = (params) => {
                resultWpm.textContent = params.get('wpm') || 0;
                resultAcc.textContent = `${params.get('acc') || 100}%`;
                const name = params.get('name') || 'Unknown';
                resultKeyboard.textContent = name;
                resultKeyboard.title = name;

                // Handle Datadog source info from URL
                if (params.get('dd') === '1') {
                    const ddTitle = params.get('dd_title') || 'Datadog Documentation';
                    const ddSource = params.get('dd_source') || 'https://docs.datadoghq.com/';
                    datadogLink.href = ddSource;
                    datadogLink.textContent = `${ddTitle} - Datadog Documentation`;
                    datadogSource.classList.remove('hidden');
                } else {
                    datadogSource.classList.add('hidden');
                }

                shareUrlInput.value = window.location.href;
                showResultsScreen();
            };

            // --- Toast Functions ---
            const showToast = () => {
                bitsToast.classList.remove('hidden');
                bitsToast.classList.add('toast-enter');
                
                // Hide results actions when toast is shown
                resultsActions.classList.add('hidden');
                
                // Trigger animation
                setTimeout(() => {
                    bitsToast.classList.remove('toast-enter');
                    bitsToast.classList.add('toast-enter-active');
                }, 10);
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    hideToast();
                }, 10000);
            };

            const hideToast = () => {
                bitsToast.classList.remove('toast-enter-active');
                bitsToast.classList.add('toast-exit');
                
                // Show results actions when toast is hidden
                resultsActions.classList.remove('hidden');
                
                setTimeout(() => {
                    bitsToast.classList.add('hidden');
                    bitsToast.classList.remove('toast-exit');
                }, 300);
            };

            // --- Leaderboard Functions ---
            const addToLeaderboard = (wpm, accuracy, name) => {
                const leaderboard = getLeaderboard();
                const entry = {
                    wpm: parseInt(wpm),
                    accuracy: parseInt(accuracy),
                    name: name,
                    timestamp: new Date().toISOString()
                };
                
                // Add new entry
                leaderboard.push(entry);
                
                // Sort by WPM (descending), then by accuracy (descending)
                leaderboard.sort((a, b) => {
                    if (a.wpm !== b.wpm) {
                        return b.wpm - a.wpm;
                    }
                    return b.accuracy - a.accuracy;
                });
                
                // Keep only top 10 entries
                const topEntries = leaderboard.slice(0, 10);
                
                // Save to localStorage
                localStorage.setItem('typing-leaderboard', JSON.stringify(topEntries));
                
                // Update display
                updateLeaderboardDisplay();
            };

            const getLeaderboard = () => {
                try {
                    const stored = localStorage.getItem('typing-leaderboard');
                    return stored ? JSON.parse(stored) : [];
                } catch (e) {
                    return [];
                }
            };

            const updateLeaderboardDisplay = () => {
                const leaderboard = getLeaderboard();
                
                if (leaderboard.length === 0) {
                    leaderboardContainer.innerHTML = '<div class="text-gray-400 text-sm">No results yet. Be the first to complete a test!</div>';
                    return;
                }
                
                const leaderboardHTML = leaderboard.map((entry, index) => {
                    const medal = index === 0 ? '' : index === 1 ? '' : index === 2 ? '' : '';
                    const rank = index + 1;
                    const date = new Date(entry.timestamp).toLocaleDateString();
                    
                    return `
                        <div class="flex items-center justify-between bg-gray-700 p-3 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <span class="text-lg">${medal}</span>
                                <span class="font-bold text-white">#${rank}</span>
                                <span class="text-white">${entry.name}</span>
                            </div>
                            <div class="flex items-center space-x-4 text-sm">
                                <span class="text-green-400">${entry.wpm} WPM</span>
                                <span class="text-blue-400">${entry.accuracy}%</span>
                                <span class="text-gray-400">${date}</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                leaderboardContainer.innerHTML = leaderboardHTML;
            };

            const copyLeaderboardUrl = () => {
                const leaderboard = getLeaderboard();
                if (leaderboard.length === 0) {
                    alert('No leaderboard entries to share yet!');
                    return;
                }
                
                const params = new URLSearchParams();
                leaderboard.forEach((entry, index) => {
                    params.append(`lb${index}_wpm`, entry.wpm);
                    params.append(`lb${index}_acc`, entry.accuracy);
                    params.append(`lb${index}_name`, entry.name);
                    params.append(`lb${index}_ts`, entry.timestamp);
                });
                
                const url = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
                
                try {
                    navigator.clipboard.writeText(url).then(() => {
                        copyLeaderboardBtn.textContent = 'Copied!';
                        setTimeout(() => { copyLeaderboardBtn.textContent = 'Copy Leaderboard URL'; }, 2000);
                    });
                } catch (err) {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        copyLeaderboardBtn.textContent = 'Copied!';
                        setTimeout(() => { copyLeaderboardBtn.textContent = 'Copy Leaderboard URL'; }, 2000);
                    } catch (err) {
                        alert('Failed to copy. Please copy the URL manually: ' + url);
                    }
                    document.body.removeChild(textArea);
                }
            };

            const loadLeaderboardFromURL = (params) => {
                const leaderboard = [];
                let index = 0;
                
                while (params.has(`lb${index}_wpm`)) {
                    const entry = {
                        wpm: parseInt(params.get(`lb${index}_wpm`)),
                        accuracy: parseInt(params.get(`lb${index}_acc`)),
                        name: params.get(`lb${index}_name`),
                        timestamp: params.get(`lb${index}_ts`)
                    };
                    leaderboard.push(entry);
                    index++;
                }
                
                if (leaderboard.length > 0) {
                    localStorage.setItem('typing-leaderboard', JSON.stringify(leaderboard));
                    updateLeaderboardDisplay();
                }
            };

            // --- Start the App ---
            init();
        });
    </script>
</body>
</html>
